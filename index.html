<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>EDI Mapper</title>
    <link rel="shortcut icon" href="#"/>
    <style>
        body {
            font-family: sans-serif;
        }
        article {
            display: flex;
        }
        #edi, #json {
            width: 50%;
            margin: 0;
            padding: 1rem;
        }
        #json {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
<h1>EDI Mapper</h1>
<article>
    <textarea id="edi"></textarea>
    <pre id="json"></pre>
</article>
<script type="module">
  const buildFileFormData = ({ fileName = "", fileContent = "" } = {}) => {
    const formData = new FormData();
    formData.append(fileName, new Blob([fileContent]), fileName);
    return formData;
  }
  const renderPurchaseOrderDocumentJson = async ({
    purchaseOrderDocumentEdiFileContent = ""
  } = {}) => {
    const purchaseOrderDocument = await fetch(
      "http://localhost:8080/purchase-order-document",
      {
        method: "POST",
        body: buildFileFormData({
          fileName: "purchaseOrderDocument",
          fileContent: purchaseOrderDocumentEdiFileContent
        })
      }
    );
    const purchaseOrderDocumentJson = await purchaseOrderDocument.json();
    document.getElementById("json").textContent = JSON.stringify(
      purchaseOrderDocument.ok ? purchaseOrderDocumentJson : purchaseOrderDocumentJson.message,
      null,
      2
    )
  }
  document.getElementById("edi").addEventListener("input", (event) => {
    renderPurchaseOrderDocumentJson({
      purchaseOrderDocumentEdiFileContent: event.target.value
    })
  });
  renderPurchaseOrderDocumentJson();
</script>
</body>
</html>