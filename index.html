<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>EDI Mapper</title>
    <link rel="shortcut icon" href="#"/>
    <style>
        body {
            font-family: sans-serif;
        }
        article {
            display: flex;
        }
        #edi, #json {
            width: 50%;
            margin: 0;
            padding: 1rem;
        }
        #json {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
<h1>EDI Mapper</h1>
<article>
    <textarea id="edi"></textarea>
    <json-viewer id="json"></json-viewer>
</article>
<script src="https://cdn.jsdelivr.net/npm/@alenaksu/json-viewer@0.3.4/dist/index.min.js"></script>
<script type="module">
  const buildFileFormData = ({ fileName = "", fileContent = "" } = {}) => {
    const formData = new FormData();
    formData.append(fileName, new Blob([fileContent]), fileName);
    return formData;
  }
  const renderDocumentJson = async ({
    ediFileContent = ""
  } = {}) => {
    const response = await fetch(
      "http://localhost:8080/invoice-document",
      {
        method: "POST",
        body: buildFileFormData({
          fileName: "invoiceDocument",
          fileContent: ediFileContent
        })
      }
    );
    const documentJson = await response.json();
    document.getElementById("json").data =
      response.ok
        ? documentJson
        : documentJson.message
  }
  document.getElementById("edi").addEventListener("input", (event) => {
    renderDocumentJson({
      ediFileContent: event.target.value
    })
  });
  renderDocumentJson();
</script>
</body>
</html>